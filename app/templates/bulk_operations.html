{% extends 'base.html' %}
{% block title %}Bulk operations{% endblock %}
{% block content %}
<section class="card">
  <h2>Bulk command execution (SSH)</h2>
  <form method="post">
    {{ form.hidden_tag() }}
    <label>{{ form.host_ids.label }}
      {{ form.host_ids(size=12, class_='multi-select') }}
    </label>
    <label>{{ form.command.label }} {{ form.command(rows=4, placeholder='uptime') }}</label>
    {{ form.submit(class_='btn') }}
  </form>
</section>

<section class="card">
  <h3>Recent operations</h3>
  <table>
    <thead><tr><th>Host</th><th>Status</th><th>Started</th><th>Command</th><th>stderr</th></tr></thead>
    <tbody>
      {% for run in recent_bulk %}
      <tr>
        <td>{{ run.host.name }}</td>
        <td><span class="pill {{ run.status }}">{{ run.status }}</span></td>
        <td>{{ run.started_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td><code>{{ run.command }}</code></td>
        <td><code>{{ run.stderr[:140] }}</code></td>
      </tr>
      {% else %}
      <tr><td colspan="5">No operation history yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
