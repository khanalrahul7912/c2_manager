{% extends 'base.html' %}
{% block title %}{{ shell.name }}{% endblock %}
{% block content %}
<section class="card">
  <div class="card-header">
    <h2>Shell: {{ shell.name }}</h2>
    <div class="toolbar">
      {% if current_user.role == 'admin' %}
      <a href="{{ url_for('main.edit_shell', shell_id=shell.id) }}" class="btn ghost">Edit</a>
      {% endif %}
      <a href="{{ url_for('main.shells_dashboard') }}" class="btn ghost">Back to Shells</a>
    </div>
  </div>

  <table>
    <tr>
      <th style="width: 200px;">Status</th>
      <td>
        {% if is_connected %}
        <span class="pill success">● Connected</span>
        {% else %}
        <span class="pill failed">○ Disconnected</span>
        {% endif %}
      </td>
    </tr>
    <tr><th>Address</th><td><code>{{ shell.address }}:{{ shell.port }}</code></td></tr>
    <tr><th>Group</th><td>{{ shell.group_name }}</td></tr>
    <tr><th>Platform</th><td>{{ shell.platform or 'Unknown' }}</td></tr>
    <tr><th>Hostname</th><td>{{ shell.hostname or '-' }}</td></tr>
    <tr><th>Connected At</th><td>{{ shell.connected_at.strftime('%Y-%m-%d %H:%M:%S') if shell.connected_at else 'Never' }}</td></tr>
    <tr><th>Last Seen</th><td>{{ shell.last_seen.strftime('%Y-%m-%d %H:%M:%S') if shell.last_seen else 'Never' }}</td></tr>
    <tr><th>Disconnected At</th><td>{{ shell.disconnected_at.strftime('%Y-%m-%d %H:%M:%S') if shell.disconnected_at else '-' }}</td></tr>
  </table>
</section>

{% if is_connected %}
<section class="card" style="margin-top: 1rem;">
  <h3>Execute Command</h3>
  <form method="post">
    {{ form.hidden_tag() }}
    <label>{{ form.command.label }}
      {{ form.command(rows=4, placeholder='whoami', class_='command-input') }}
    </label>
    {{ form.submit(class_='btn') }}
  </form>
</section>
{% else %}
<section class="card" style="margin-top: 1rem;">
  <h3>Shell Offline</h3>
  <p>This shell is not currently connected. Commands cannot be executed until it reconnects.</p>
</section>
{% endif %}

<section class="card" style="margin-top: 1rem;">
  <h3>Command History</h3>
  {% with terminal_title=shell.hostname or shell.name ~ ' (' ~ shell.address ~ ')',
          shell_type='reverse',
          pagination=executions_pagination,
          detail_url='main.shell_detail',
          detail_id_name='shell_id',
          detail_id_value=shell.id %}
    {% include 'components/terminal_history.html' %}
  {% endwith %}
</section>
{% endblock %}
